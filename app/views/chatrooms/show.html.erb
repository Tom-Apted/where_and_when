<div class="container d-flex flex-column"
  data-controller="chatroom-subscription"
  data-chatroom-subscription-chatroom-id-value="<%= @chatroom.id %>">
  <div data-controller="insert-date-details">
    <% if @our_date == nil %>
      <div class="button-center">
        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#arrangedate" data-insert-date-details-target="arrange">
          Book me a date
        </button>
      </div>
    <% else %>
      <div class="button-center">
        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#confirmdate">
          Date suggestion
        </button>
      </div>
    <% end %>
    <h1><%= @chatroom.name %></h1>
    <div class="messages flex-grow-1" data-chatroom-subscription-target="messages">
      <div class="messages-inner">
        <% @chatroom.messages.each do |message| %>
            <%= render "messages/message", message: message %>
        <% end %>
      </div>
    </div>
    <div class="message-form">
      <%= simple_form_for [@chatroom, @message],
        html: { data: { action: "turbo:submit-end->chatroom-subscription#resetForm" }, class: "d-flex" } do |f|
      %>
      <%= f.input :content,
        label: false,
        placeholder: "Message #{@chatroom.name}",
        wrapper_html: {class: "flex-grow-1"}
        %>
          <%= f.submit "Send", class: "btn btn-primary mb-4" %>
        <% end %>
    </div>
    <!-- arrange my date  model trigger -->
    <!-- logic to find our match and out date -->
    <!-- arrange my date -->
    <div class="modal fade" id="arrangedate" tabindex="-1" aria-labelledby="arrangedateLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="arrangedateLabel">Book me a date!</h5>
          </div>
          <div class="modal-body">
            <%= simple_form_for [@chatroom, @suggested_date], data: {insert_date_details_target: "form", action: "submit->insert-date-details#insert"} do |f| %>
              <%= f.association :match, as: :hidden, input_html: { value: @chatroom.match.id } %>
            <%= f.submit 'Lucky dip' %>
            <% end %>
            <div id="date-details" data-insert-date-details-target="details">
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
   </div>
     <div class="modal fade" id="confirmdate" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">Your date details</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div id="date-details" data-insert-date-details-target="details">
              <% if @our_date != nil %>
                <div>
                  <p><strong>What:</strong> <%= @our_date.date_location.date_type %></p>
                  <p><strong>When: </strong><%= @our_date.time %>, <%= @our_date.date %></p>
                  <p><strong>Where:</strong> <%= @our_date.date_location.name %> @ <%= @our_date.date_location.address %></p>
                  <p style="color: green; font-weight:bold">We've sent this to your match!</p>
                </div>
              <% end %>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>
  </div>
<!--view my date modal-->
